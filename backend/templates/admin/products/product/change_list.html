
{% extends "admin/change_list.html" %}
{% load i18n static admin_urls %}

{% block extrastyle %}{{ block.super }}
<script src="{% static 'js/product_list.js' %}"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
<style>
body {
    font-family: 'Poppins', sans-serif;
}

/* Header Styles */
.breadcrumbs {
    background: #fff;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 0.2rem 0.5rem rgba(0, 0, 0, 0.05);
}

.breadcrumbs a {
    color: #4c6ef5;
    text-decoration: none;
    font-weight: 500;
}

.breadcrumbs a:hover {
    text-decoration: underline;
}

.breadcrumbs .current {
    color: #495057;
    font-weight: 600;
}

/* Main Content Container */
.content-main {
    padding: 0;
}

/* Toolbar Styles */
.module {
    overflow: hidden;
    margin-bottom: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 0.2rem 0.5rem rgba(0, 0, 0, 0.05);
}

.module h2, .module caption {
    background: linear-gradient(135deg, #4c6ef5 0%, #845ef7 100%);
    color: white;
    padding: 1rem 1.5rem;
    margin: 0;
    font-size: 1.2rem;
    font-weight: 600;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
}

.module h2 i, .module caption i {
    margin-right: 0.5rem;
}

/* Table Styles */
.result-list {
    width: 100%;
    border-collapse: collapse;
}

.result-list thead th {
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.05em;
    color: #495057;
    padding: 0.75rem 1rem;
    text-align: right;
}

.result-list tbody tr {
    border-bottom: 1px solid #e9ecef;
}

.result-list tbody tr:hover {
    background-color: rgba(76, 110, 245, 0.05);
}

.result-list tbody td {
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
}

.result-list tbody tr:last-child td {
    border-bottom: none;
}

.result-list .field-name {
    font-weight: 500;
    color: #495057;
}

.result-list .field-image {
    width: 50px;
    height: 50px;
    border-radius: 0.25rem;
    object-fit: cover;
}

.result-list .field-price {
    font-weight: 600;
    color: #28a745;
}

.result-list .field-discount {
    color: #dc3545;
    font-weight: 500;
}

.result-list .field-stock {
    font-weight: 500;
}

.result-list .field-stock.in-stock {
    color: #28a745;
}

.result-list .field-stock.low-stock {
    color: #ffc107;
}

.result-list .field-stock.out-of-stock {
    color: #dc3545;
}

.result-list .field-boolean {
    text-align: center;
}

.result-list .field-boolean i {
    font-size: 1.2rem;
}

.result-list .field-boolean i.fa-check-circle {
    color: #28a745;
}

.result-list .field-boolean i.fa-times-circle {
    color: #dc3545;
}

.result-list .field-choices {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
}

.result-list .field-choices span {
    background: #e9ecef;
    color: #495057;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.85rem;
}

.result-list .actions {
    white-space: nowrap;
}

.result-list .actions a {
    margin-left: 0.5rem;
    color: #4c6ef5;
    text-decoration: none;
    font-size: 1.1rem;
}

.result-list .actions a:hover {
    color: #364fc7;
}

/* Pagination Styles */
.paginator {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
    gap: 0.25rem;
}

.paginator a, .paginator .this-page {
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
}

.paginator a {
    color: #4c6ef5;
    background: #e9ecef;
}

.paginator a:hover {
    background: #dee2e6;
    color: #364fc7;
}

.paginator .this-page {
    background: #4c6ef5;
    color: white;
}

.paginator .disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Search and Filter Styles */
#changelist-search {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

#changelist-search .input-group {
    flex: 1;
    position: relative;
}

#changelist-search .input-group input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    font-size: 1rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

#changelist-search .input-group input:focus {
    border-color: #4c6ef5;
    box-shadow: 0 0 0 0.2rem rgba(76, 110, 245, 0.25);
    outline: none;
}

#changelist-search .input-group i {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
}

#changelist-search button {
    padding: 0.75rem 1.5rem;
    background: #4c6ef5;
    color: white;
    border: none;
    border-radius: 0.25rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

#changelist-search button:hover {
    background: #364fc7;
}

/* Filter Styles */
#changelist-filter {
    background: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 0.2rem 0.5rem rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

#changelist-filter h2 {
    background: linear-gradient(135deg, #4c6ef5 0%, #845ef7 100%);
    color: white;
    padding: 0.75rem 1rem;
    margin: -1.5rem -1.5rem 1rem -1.5rem;
    font-size: 1.1rem;
    font-weight: 600;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
    display: flex;
    align-items: center;
}

#changelist-filter h2 i {
    margin-right: 0.5rem;
}

#changelist-filter h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #495057;
    margin: 1.5rem 0 0.75rem 0;
}

#changelist-filter ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

#changelist-filter li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
}

#changelist-filter li:last-child {
    border-bottom: none;
}

#changelist-filter li a {
    color: #495057;
    text-decoration: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#changelist-filter li a:hover {
    color: #4c6ef5;
}

#changelist-filter li a.active {
    color: #4c6ef5;
    font-weight: 500;
}

#changelist-filter li a i {
    color: #6c757d;
    font-size: 0.9rem;
}

#changelist-filter li a.active i {
    color: #4c6ef5;
}

/* Action Buttons */
.object-tools {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.object-tools a {
    padding: 0.5rem 1rem;
    background: #4c6ef5;
    color: white;
    border-radius: 0.25rem;
    text-decoration: none;
    font-weight: 500;
    display: flex;
    align-items: center;
    transition: background 0.3s ease;
}

.object-tools a:hover {
    background: #364fc7;
}

.object-tools a i {
    margin-right: 0.5rem;
}

/* Bulk Actions */
.bulk-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.bulk-actions select {
    padding: 0.5rem;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    font-size: 1rem;
}

.bulk-actions button {
    padding: 0.5rem 1rem;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 0.25rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

.bulk-actions button:hover {
    background: #c82333;
}

/* Responsive */
@media (max-width: 768px) {
    #changelist-search {
        flex-direction: column;
    }

    .bulk-actions {
        flex-direction: column;
        gap: 1rem;
    }

    .bulk-actions select, .bulk-actions button {
        width: 100%;
    }

    .result-list {
        font-size: 0.85rem;
    }

    .result-list .field-image {
        width: 40px;
        height: 40px;
    }

    .object-tools {
        flex-wrap: wrap;
    }
}
</style>
{% endblock %}

{% block content_title %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' %}</a>
    &rsaquo;
    <a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{{ cl.opts.app_config.verbose_name }}</a>
    &rsaquo;
    <a href="{% url cl.opts|admin_urlname:'changelist' %}">{{ cl.opts.verbose_name_plural }}</a>
    &rsaquo;
    <span class="current">{% if not is_popup %}{% trans 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' %}{% endif %}</span>
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <!-- Search and Filter Section -->
    <div class="module">
        <div id="changelist-search">
            <div class="input-group">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." value="{{ search_query|default:'' }}">
            </div>
            <button type="button" onclick="performSearch()">
                <i class="fas fa-search"></i> Ø¨Ø­Ø«
            </button>
        </div>

        <div class="bulk-actions">
            <div>
                <select id="action-select">
                    <option value="">----</option>
                    <option value="activate">ØªÙØ¹ÙŠÙ„</option>
                    <option value="deactivate">ØªØ¹Ø·ÙŠÙ„</option>
                    <option value="delete">Ø­Ø°Ù</option>
                    <option value="featured">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</option>
                    <option value="unfeatured">Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ù…ÙŠØ²Ø©</option>
                </select>
                <button type="button" onclick="performBulkAction()">ØªÙ†ÙÙŠØ°</button>
            </div>
            <div>
                <span>Ø§Ù„Ù†ØªØ§Ø¦Ø¬: {{ cl.result_count }}</span>
            </div>
        </div>
    </div>

    <!-- Product List -->
    <div class="module">
        <table id="result_list" class="result-list">
            <thead>
                <tr>
                    <th scope="col" class="action-checkbox-column">
                        <div class="text">
                            <input type="checkbox" id="toggle" onchange="toggleAll(this)">
                        </div>
                    </th>
                    <th scope="col">ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±Ø©</th>
                    <th scope="col">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th scope="col">Ø§Ù„Ù‚Ø³Ù…</th>
                    <th scope="col">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</th>
                    <th scope="col">Ø§Ù„Ø³Ø¹Ø±</th>
                    <th scope="col">Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</th>
                    <th scope="col">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                    <th scope="col">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                    <th scope="col">Ù†Ø´Ø·</th>
                    <th scope="col">Ù…Ù…ÙŠØ²</th>
                    <th scope="col">Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</th>
                    <th scope="col">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th scope="col">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for result in cl.result_list %}
                <tr>
                    <td class="action-checkbox">
                        <input type="checkbox" name="_selected_action" value="{{ result.pk|default:'' }}">
                    </td>
                    <td class="field-product_image">
                        {% if result.main_image %}
                            <img src="{{ result.main_image }}" alt="{{ result.name }}" class="field-image">
                        {% else %}
                            <span>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</span>
                        {% endif %}
                    </td>
                    <td class="field-name">
                        <a href="{% url cl.opts|admin_urlname:'change' result.pk %}">{{ result.name }}</a>
                    </td>
                    <td class="field-category">
                        {{ result.category.name }}
                    </td>
                    <td class="field-brand">
                        {{ result.brand|default:'-' }}
                    </td>
                    <td class="field-price">
                        <span class="field-price">{{ result.price }} Ø¯.Ø¹</span>
                    </td>
                    <td class="field-wholesale_price">
                        <span class="field-price">{{ result.wholesale_price }} Ø¯.Ø¹</span>
                    </td>
                    <td class="field-stock_quantity">
                        {% if result.stock_quantity > 10 %}
                            <span class="field-stock in-stock">{{ result.stock_quantity }} Ù…ØªÙˆÙØ±</span>
                        {% elif result.stock_quantity > 0 %}
                            <span class="field-stock low-stock">{{ result.stock_quantity }} Ù‚Ù„ÙŠÙ„</span>
                        {% else %}
                            <span class="field-stock out-of-stock">Ù†ÙØ¯</span>
                        {% endif %}
                    </td>
                    <td class="field-display_order">
                        {{ result.display_order }}
                    </td>
                    <td class="field-is_active">
                        {% if result.is_active %}
                            <i class="fas fa-check-circle field-boolean"></i>
                        {% else %}
                            <i class="fas fa-times-circle field-boolean"></i>
                        {% endif %}
                    </td>
                    <td class="field-is_featured">
                        {% if result.is_featured %}
                            <i class="fas fa-star field-boolean"></i>
                        {% else %}
                            <i class="far fa-star field-boolean"></i>
                        {% endif %}
                    </td>
                    <td class="field-show_on_homepage">
                        {% if result.show_on_homepage %}
                            <i class="fas fa-check-circle field-boolean"></i>
                        {% else %}
                            <i class="fas fa-times-circle field-boolean"></i>
                        {% endif %}
                    </td>
                    <td class="field-created_at">
                        {{ result.created_at|date:"d/m/Y H:i" }}
                    </td>
                    <td class="actions">
                        <a href="{% url cl.opts|admin_urlname:'change' result.pk %}" title="ØªØ¹Ø¯ÙŠÙ„">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url cl.opts|admin_urlname:'delete' result.pk %}" title="Ø­Ø°Ù">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if cl.has_pagination %}
    <div class="paginator">
        {% for i in page_range %}
            {% if i == cl.page_num %}
                <span class="this-page">{{ i }}</span>
            {% elif i == '...' %}
                <span class="ellipsis">...</span>
            {% else %}
                <a href="?page={{ i }}{% if search_query %}&q={{ search_query }}{% endif %}">{{ i }}</a>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Add Button -->
    <div class="object-tools">
        <a href="{% url cl.opts|admin_urlname:'add' %}" class="addlink">
            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        </a>
    </div>

    <!-- Filters -->
    <div id="changelist-filter">
        <h2><i class="fas fa-filter"></i> ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>

        <div id="changelist-filter-sidebar">
            <!-- Status Filter -->
            <h3>Ø§Ù„Ø­Ø§Ù„Ø©</h3>
            <ul>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}{% endif %}" class="{% if not status_filter %}active{% endif %}">
                        Ø§Ù„ÙƒÙ„
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&status=active{% endif %}" class="{% if status_filter == 'active' %}active{% endif %}">
                        Ù†Ø´Ø·
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&status=inactive{% endif %}" class="{% if status_filter == 'inactive' %}active{% endif %}">
                        ØºÙŠØ± Ù†Ø´Ø·
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            </ul>

            <!-- Category Filter -->
            <h3>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h3>
            <ul>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}{% endif %}" class="{% if not category_filter %}active{% endif %}">
                        Ø§Ù„ÙƒÙ„
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                {% for category in categories %}
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&category={{ category.id }}{% endif %}" class="{% if category_filter == category.id|slugify %}active{% endif %}">
                        {{ category.name }}
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                {% endfor %}
            </ul>

            <!-- Featured Filter -->
            <h3>Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h3>
            <ul>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}{% endif %}" class="{% if not featured_filter %}active{% endif %}">
                        Ø§Ù„ÙƒÙ„
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&featured=1{% endif %}" class="{% if featured_filter == '1' %}active{% endif %}">
                        Ù†Ø¹Ù…
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&featured=0{% endif %}" class="{% if featured_filter == '0' %}active{% endif %}">
                        Ù„Ø§
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            </ul>

            <!-- Stock Filter -->
            <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
            <ul>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}{% endif %}" class="{% if not stock_filter %}active{% endif %}">
                        Ø§Ù„ÙƒÙ„
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&stock=in{% endif %}" class="{% if stock_filter == 'in' %}active{% endif %}">
                        Ù…ØªÙˆÙØ±
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&stock=low{% endif %}" class="{% if stock_filter == 'low' %}active{% endif %}">
                        Ù‚Ù„ÙŠÙ„
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                <li>
                    <a href="{% if search_query %}?q={{ search_query }}&stock=out{% endif %}" class="{% if stock_filter == 'out' %}active{% endif %}">
                        Ù†ÙØ¯
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<script>
// Search functionality
function performSearch() {
    const searchInput = document.querySelector('#changelist-search input');
    const query = searchInput.value.trim();

    if (query) {
        window.location.href = '?q=' + encodeURIComponent(query);
    } else {
        window.location.href = '{% url cl.opts|admin_urlname:'changelist' %}';
    }
}

// Bulk actions
function performBulkAction() {
    const action = document.getElementById('action-select').value;
    const checkboxes = document.querySelectorAll('input[name="_selected_action"]:checked');

    if (!action) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø±Ø§Ø¡');
        return;
    }

    if (checkboxes.length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }

    if (action === 'delete') {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.')) {
            return;
        }
    }

    // In a real implementation, you would submit a form here
    // For demonstration, we'll just show a message
    const selectedIds = Array.from(checkboxes).map(cb => cb.value).join(', ');
    alert(`Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ "${action}" Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©: ${selectedIds}`);
}

// Toggle all checkboxes
function toggleAll(source) {
    const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = source.checked;
    });
}

// Handle Enter key in search input
document.querySelector('#changelist-search input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performSearch();
    }
});
</script>
{% endblock %}
